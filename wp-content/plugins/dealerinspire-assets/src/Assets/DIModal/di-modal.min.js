var DI_Modal = function() {
    var i = null,
        d = null,
        a = null,
        l = [],
        c = !1,
        n = null,
        o = {
            class: "",
            theme: []
        },
        e = function() {
            return '<div class="di-modal-box"><div class="di-modal-box-inner"></div>' + t() + "</div>"
        },
        t = function() {
            return '<button aria-label="close" class="di-modal-close"></button>'
        },
        u = {
            placeholder: '<div class="di-modal-placeholder"></div>',
            container: '<div id="di-modal" role="dialog" aria-hidden="true" tabindex="-1"><div class="modal-wrap">' + e() + "</div></div>",
            iframe: "<iframe src={src}></iframe>"
        },
        r = function() {
            document.body.insertAdjacentHTML("beforeEnd", u.container)
        },
        m = function() {
            i = document.querySelector("#di-modal"), modal_close_el = document.querySelector("#di-modal .di-modal-close")
        },
        s = function() {
            document.body.addEventListener("click", h), document.body.addEventListener("click", y), i && i.addEventListener("keydown", g)
        },
        f = function() {
            jQuery(document).on("gform_post_render", function(e, t, n) {
                if (document.querySelector("#di-modal form div.validation_error")) {
                    var o = document.querySelector("#di-modal .di-modal-body");
                    o && 0 < o.scrollTop ? o.scrollTop = 0 : 0 < i.scrollTop && (i.scrollTop = 0)
                }
            }), jQuery(document).on("gform_confirmation_loaded", function(e, t, n) {
                document.querySelector("#di-modal.faded-in .replaced-submit-btn .gforms_confirmation_message") && T(document.querySelector("#di-modal #custom-submit-btn"))
            })
        },
        b = function(e) {
            var t = e.querySelector('[type="submit"]'),
                n = t.getAttribute("value") || t.innerHTML || "Submit",
                o = document.createElement("button");
            return o.id = "custom-submit-btn", o.classList.add("button--primary"), o.innerHTML = n, o.ariaLabel = n, o.tabIndex = v(e), o.onclick = function() {
                p()
            }, o
        },
        p = function() {
            var e = document.querySelector('#di-modal form [type="submit"]');
            e && e.click()
        },
        v = function(e) {
            return e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').length + 1
        },
        y = function(e) {
            var t = D(e.target, ".di-modal");
            t && (n = t, e.preventDefault(), k("beforeOpen.di.modal", {
                event: t
            }), q(), S(t))
        },
        h = function(e) {
            M(i, "faded-in") && ("click" === e.type && e.target && M(e.target, "di-modal-close") || D(e.target, "#di-modal") && !D(e.target, ".di-modal-box-inner")) && (e.preventDefault(), q())
        },
        g = function(e) {
            if ("Escape" === e.key) return e.preventDefault(), void q();
            if ("Tab" === e.key) {
                var t = i.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),
                    n = t[0],
                    o = t[t.length - 1],
                    r = document.activeElement;
                !e.shiftKey || r !== n && r !== this || (o.focus(), e.preventDefault()), e.shiftKey || r !== o || (n.focus(), e.preventDefault())
            }
        },
        S = function(e) {
            if (! function(e) {
                    if ("string" == typeof e ? (a = e, C()) : a = e.getAttribute("href"), "#" == a.charAt(0) ? (d = "content", a = a.replace(/\./g, "\\.")) : d = "iframe", a && ("content" != d || document.querySelector(a)) && "content" == d) {
                        var t = _(document.querySelector(a));
                        if (0 < t.length && -1 < (l = t).indexOf("modal--action-bar") && (c = !0), document.querySelector(a).getAttribute("data-mobileSize")) {
                            var n = document.querySelector(a).getAttribute("data-mobileSize");
                            l.push("modal-size--mobile-" + n)
                        }
                    }
                }(e), L(), "content" == d) {
                var t = document.querySelector(a);
                if ((M(i, "modal--light-mode") || M(i, "footer-form-button")) && 0 < t.querySelectorAll("form").length && !M(t, "replaced-submit-btn") && !M(t, "replace-submit-btn-failed") && function(e) {
                        var t = e.querySelectorAll("form");
                        if (1 === t.length) {
                            j(e, "replaced-submit-btn");
                            var n = e.querySelector(".di-modal-footer"),
                                o = t[0],
                                r = o.querySelector('[type="submit"] + p');
                            n ? n.insertAdjacentElement("afterbegin", b(o)) : ((n = document.createElement("div")).classList.add("di-modal-footer"), n.appendChild(b(o)), e.insertAdjacentElement("beforeend", n)), r && (j(r, "submit-disclaimer"), n.insertAdjacentElement("beforeend", r))
                        } else 1 < t.length && (j(e, "replace-submit-btn-failed"), console.log("Couldn't move submit button to footer because modal has multiple forms. Modal ID: " + e.getAttribute("id")))
                    }(t), void 0 !== t && null != t) {
                    if (M(i, "faded-in")) {
                        var n = document.querySelector(".di-modal-placeholder"),
                            o = document.querySelector("#di-modal .di-modal-box-inner").children[0];
                        n.insertAdjacentElement("afterend", o), T(o), n.parentNode.removeChild(n)
                    }
                    M(i, "modal--light-mode") && (t.getElementsByClassName("di-modal-head").length || t.insertAdjacentHTML("afterbegin", '<div class="di-modal-head"></div>')), t.insertAdjacentHTML("afterend", u.placeholder), document.querySelector("#di-modal .di-modal-box-inner").appendChild(t),
                        function(e) {
                            e.style.display = "block"
                        }(t), A(), x(t)
                } else console.log("Cannot find content for modal.")
            } else if ("iframe" == d)
                if (void 0 !== a && "" !== a) {
                    var r = function(n, o) {
                        return bracket_str = n.match(/\{([^}]+)\}/g), bracket_str.forEach(function(e) {
                            for (var t in o) e.replace(/[{}]/g, "") == t && (n = n.replace(e, o[t]))
                        }), n
                    }(u.iframe, {
                        src: a
                    });
                    A(), document.querySelector("#di-modal .di-modal-box-inner").insertAdjacentHTML("beforeEnd", r), j(i, "iframe-open")
                } else console.log("Cannot find url for modal")
        },
        q = function() {
            if (M(i, "faded-in")) {
                var e = document.querySelector("#di-modal .di-modal-box-inner").children[0];
                if (E(), C(), "content" == d) {
                    var t = document.querySelector(".di-modal-placeholder");
                    t ? (t.insertAdjacentElement("afterend", e), T(e), t.parentNode.removeChild(t)) : e.remove()
                } else w(i, "iframe-open"), document.querySelector("#di-modal iframe").parentNode.removeChild(document.querySelector("#di-modal iframe"))
            }
        },
        A = function() {
            k("onOpen.di.modal"), j(i, "faded-in"), j(document.body, "di-modal-open"), 1 == c && j(document.body, "di-modal-enable-scroll"), i.setAttribute("aria-hidden", "false"), i.setAttribute("tabindex", "0"), i.focus(), k("onOpen.di.modal.loaded"), k("di_check_visible_forms")
        },
        E = function() {
            w(i, "faded-in"), w(document.body, "di-modal-open"), i.setAttribute("aria-hidden", "true"), i.setAttribute("tabindex", "-1"), n && (n.focus(), n = null), k("onClose.di.modal")
        },
        x = function(e) {
            for (var t = e.querySelectorAll(".swiper-wrapper"), n = 0; n < t.length; n++) void 0 !== t[n].parentNode.swiper && t[n].parentNode.swiper.update()
        },
        L = function() {
            if (0 < l.length)
                for (var e = 0; e < l.length; e++) j(i, l[e])
        },
        _ = function(e) {
            var t = e.getAttribute("data-theme") || e.getAttribute("data-modal-classes");
            return t ? t.split(" ") : o.theme
        },
        C = function() {
            if (0 < l.length) {
                for (var e = 0; e < l.length; e++) w(i, l[e]);
                l = []
            }
        },
        k = function(t, n) {
            try {
                var o = new CustomEvent(t, {
                    detail: n
                })
            } catch (e) {
                (o = document.createEvent("CustomEvent")).initCustomEvent(t, !0, !0, n)
            }
            document.dispatchEvent(o)
        };

    function M(e, t) {
        return e.classList ? e.classList.contains(t) : !!e.className.match(new RegExp("(\\s|^)" + t + "(\\s|$)"))
    }

    function j(e, t) {
        e.classList ? e.classList.add(t) : M(e, t) || (e.className += " " + t)
    }

    function w(e, t) {
        if (e.classList) e.classList.remove(t);
        else if (M(e, t)) {
            var n = new RegExp("(\\s|^)" + t + "(\\s|$)");
            e.className = e.className.replace(n, " ")
        }
    }

    function T(e) {
        e.style.display = "none"
    }
    var N = function(e) {
        e = e || {};
        for (var t = 1; t < arguments.length; t++)
            if (arguments[t])
                for (var n in arguments[t]) arguments[t].hasOwnProperty(n) && (e[n] = arguments[t][n]);
        return e
    };

    function D(e, t) {
        var n, o;
        if (["matches", "webkitMatchesSelector", "mozMatchesSelector", "msMatchesSelector", "oMatchesSelector"].some(function(e) {
                return "function" == typeof document.body[e] && (n = e, !0)
            }), e && e[n](t)) return e;
        for (; e;) {
            if ((o = e.parentElement) && o[n](t)) return o;
            e = o
        }
        return null
    }
    return {
        options: o,
        setOptions: function(e) {
            ! function(e) {
                N(o, e), o.class && j(i, o.class)
            }(e)
        },
        triggerOpen: S,
        triggerClose: q,
        init: function() {
            r(), m(), s(), f()
        }
    }
}();
DI_Modal.init();